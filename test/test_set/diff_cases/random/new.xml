<properties>
    <dataelements>
        <total>420.00</total>
        <customer>{"name": "Max Mustermann", "address": "Musterweg 1, 12345 Musterhausen"}</customer>
        <billed>false</billed>
        <items>[{"id": "smartphone"},{"id": "book"}]</items>
        <shipped>false</shipped>
    </dataelements>
    <endpoints>
        <bill>https://www.example.com/billing</bill>
        <ship>https://www.example.com/shipping</ship>
    </endpoints>
    <dslx>
        <description xmlns="http://cpee.org/ns/description/1.0">
            <parallel wait="-1">
                <parallel_branch>
                    <manipulate>data.total *= 1.19; //add tax</manipulate>
                    <call endpoint="bill">
                        <parameters>
                            <label>Bill the customer for</label>
                            <method>:post</method>
                            <arguments>
                                <amount>data.total</amount>
                                <billing_address>data.customer.address</billing_address>
                            </arguments>
                        </parameters>
                        <code>
                            <finalize output="result">
                                data.billed = result.value('success');
                            </finalize>
                        </code>
                    </call>
                </parallel_branch>
                <parallel_branch>
                    <manipulate>data.index = 0;</manipulate>
                    <loop condition="data.index < data.items.length">
                        <call endpoint="ship">
                            <parameters>
                                <label>Ship item in a package</label>
                                <method>:post</method>
                                <arguments>
                                    <item>data.items[data.index]</item>
                                    <shipping_address>data.customer.address</shipping_address>
                                </arguments>
                            </parameters>
                        </call>
                    </loop>
                    <manipulate>data.shipped = true;</manipulate>
                </parallel_branch>
            </parallel>
        </description>
    </dslx>
</properties>

